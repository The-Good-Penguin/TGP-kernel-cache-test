From 5764dec3202ba81cc86865763d45749951e538fa Mon Sep 17 00:00:00 2001
From: kas User <kas@example.com>
Date: Tue, 9 Sep 2025 20:28:16 +0100
Subject: [PATCH] Update default env for qemu test booting

Will load a bootcache file if one exists.

Upstream-Status: Inappropriate [oe specific]
---
 board/emulation/qemu-arm/qemu-arm.env | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/board/emulation/qemu-arm/qemu-arm.env b/board/emulation/qemu-arm/qemu-arm.env
index fb4adef281e..df5a44af5bf 100644
--- a/board/emulation/qemu-arm/qemu-arm.env
+++ b/board/emulation/qemu-arm/qemu-arm.env
@@ -13,3 +13,8 @@ pxefile_addr_r=0x40300000
 kernel_addr_r=0x40400000
 ramdisk_addr_r=0x44000000
 boot_targets=qfw usb scsi virtio nvme dhcp
+bootcache_addr_r=0xbfff0000
+load_bootcache=virtio scan; if test -e virtio 0:1 ${bootcache_file}; then fatload virtio 0:1 ${bootcache_addr_r} ${bootcache_file}; fi
+bootcache_file=bootcache-test-data.bin
+virtioboot=virtio scan; fatload virtio 0:1 ${kernel_addr_r} Image; fatload virtio 0:1 ${fdt_addr} qemu.dtb; setenv bootargs "console=ttyAMA0 root=/dev/vda2 rw"; run load_bootcache; booti ${kernel_addr_r} - ${fdt_addr}
+bootcmd=run virtioboot
-- 
2.39.5

